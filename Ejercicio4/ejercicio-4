#! /bin/bash

function validarParametros(){
    if [[ $1 != "--ruta" ]]; then
        echo ""
        echo "Parametro deconocido"
        echo "Ejemplo de uso: bash ejercicio4 --ruta <folder>"
        exit 1
    fi

    if [[ $2 != 2 ]]; then
        echo ""
        echo "Cantidad de parametros incorrecta, deben ser 2"
        echo "Ejemplo de uso: bash ejercicio4 --ruta <folder>"
        echo ""
        exit 1
    fi
}

if [[ $1 = "-h" || $1 = "--help" || $1 = "-?" ]]
then
    echo "Escribir ayuda"
    exit 0
fi

validarParametros $1 $#

if [[ $1 = "--ruta" ]]
then
    ruta="$2"
fi

cat $ruta |
  awk '{
    gsub(/ /,"")

    if(estoyEnComentarioMultiple == 0) {
        posicionAperturaComentarioMultiple = index($0, "/*") 
        if(posicionAperturaComentarioMultiple == 1) {
            estoyEnComentarioMultiple = 1
        } else if (posicionAperturaComentarioMultiple > 1) {
            codigos++
            estoyEnComentarioMultiple = 1
        }
    }

    if(estoyEnComentarioMultiple == 0) {
        posicionComentarioSimple = index($0, "//") 
        if(posicionComentarioSimple == 1) {
            comentarios++
        } else if (posicionComentarioSimple > 1) {
            comentarios++
            codigos++
        } else {
            codigos++
        }
    }

    if(estoyEnComentarioMultiple == 1) {
        posicionCierreComentarioMultiple = index($0, "*/") 
        if(posicionCierreComentarioMultiple >= 1) {
            comentarios++
            estoyEnComentarioMultiple = 0
        } else {
            comentarios++
        }

        if(posicionCierreComentarioMultiple !=0 && posicionCierreComentarioMultiple+1 < length($0)) {
            codigos++
        }
    }

} END {
    print "Cantidad comentarios: " comentarios
    print "Cantidad codigo: " codigos
}'